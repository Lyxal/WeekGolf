<!DOCTYPE html>
<html>
    <!-- If logged -->
    <script>
        if (localStorage.token !== ""){
            const xhttp = new XMLHttpRequest();

            xhttp.open("POST", "https://week.golf/getIdbyToken.php", true);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

            xhttp.send(`t=${localStorage.token}`);

            xhttp.onload = function() {
                const rep = JSON.parse(xhttp.responseText);
                const id = rep["id"];
                
                if (id == "" || id == null){
                    document.location.href = "https://week.golf/";
                }
            }
        }
    </script>
    <head>
        <!-- 3ncoding -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Title -->
        <title>WeekGolf</title>

        <!-- Icon -->
        <link rel="icon" href="https://i.imgur.com/9Pgc6UV.png">

        <!-- Color Theme -->
        <script src="color.js"></script>

        <!-- CSS -->
        <link href="style.css" rel="stylesheet" type="text/css" />
        <link href="header.css" rel="stylesheet" type="text/css" />
        <link href="footer.css" rel="stylesheet" type="text/css" />
        <link href="edit.css" rel="stylesheet" type="text/css" />

        <!-- Embed HTML -->
        <script src="lib/csi.js"></script>

        <!-- Header Boucing -->
        <script src="header.js"></script>


        <!-- Scroll to Top -->
        <script src="scrolltop.js"></script>

    </head>
    <body>
        <!-- Header -->
        <div data-include="header.html"></div>

        <title id="edit">Edit</title>
        <div class="bar1"></div>

        <main id="content_edit">
            <!-- PP -->
            <h5>Profile Picture</h5>
            <div class="bar2"></div>
            You can change your profile picture every 24h<br>Max size: 1 MB<br>
            Your current profile picture:<br>
            <img src="img/nouser_white.jpg" id="currentpp" alt="Default profile picture">
            <div style="height: 10px"></div>
            <iframe name="dummyframe" id="dummyframe" style="display: none;"></iframe>
            <form action="image.php" method="POST" enctype="multipart/form-data" id="formpp" target="dummyframe">
                <label class="uploadfile">
                    <input type="file" id="ppinput" accept=".jpg,.jpeg,.png,.gif" name="file"/>
                    Upload Profile Picture
                    <input type="hidden" name="var1" value="var1" id="var1">
                    <input type="hidden" name="t" value="" class="tkn">
                    <input type="hidden" name="type" value="pp">
                </label>
                <br>
                <button name="submit" type="submit" class="submit" onclick="submited(0)">Submit</button>
            </form>
            <div style="height: 30px;"></div>

            <!-- Banner -->
            <h5>Banner</h5>
            <div class="bar2"></div>
            You can change your banner every 24h<br>Max size: 1 MB<br>
            Your current banner:<br>
            <img src="img/banner.jpg" id="currentbanner" alt="Default banner">
            <div style="height: 10px"></div>
            <iframe name="dummyframe" class="dummyframe" style="display: none;"></iframe>
            <form action="image.php" method="POST" enctype="multipart/form-data" id="formpp" target="dummyframe">
                <label class="uploadfile">
                    <input type="file" id="bannerinput" accept=".jpg,.jpeg,.png,.svg" name="file"/>
                    Upload Banner
                    <input type="hidden" name="var1" value="var1" id="var1">
                    <input type="hidden" name="t" value="" class="tkn">
                    <input type="hidden" name="type" value="banner">
                </label>
                <br>
                <button name="submit" type="submit" class="submit" onclick="submited(1)">Submit</button>
            </form>
            <div style="height: 30px;"></div>

            <!-- Bio -->
            <h5>Bio</h5>
            <div class="bar2"></div>
            You can change your bio when you want<br>Max length: 1023<br>
            Your current bio:<br>
            <div id="currentbio">Hello this is my current bio everyone<br><br><br><br><br>e</div><br>
            Your new bio:<br>
            <textarea id="newbio"></textarea><br>
            <button name="submit" type="submit" class="submit" onclick="submited(2)" id="biosubmit">Submit</button>
            <div class="error_box" id="error_bio"></div>
            <div style="height: 30px;"></div>

            <!-- E-mail -->
            <h5>E-mail</h5>
            <div class="bar2"></div>
            You can change your e-mail every 24h<br>
            Your e-mail:<br>
            <textarea id="email"  oninput="this.value = this.value.replace(/\n/g,'')"></textarea><br>
            <button name="submit" type="submit" class="submit" id="emailbt">Submit</button>
            <div class="error_box" id="error_email"></div>
            <div style="height: 30px;"></div>


            <!-- Username -->
            <h5>Username</h5>
            <div class="bar2"></div>
            You can change your username every 24h<br>
            Your username:<br>
            <textarea id="username_area"  oninput="this.value = this.value.replace(/\n/g,'')"></textarea><br>
            <button name="submit" type="submit" class="submit" id="usernamebt"  placeholder="Username...">Submit</button>
            <div class="error_box" id="error_username"></div>
            <div style="height: 30px;"></div>


            <!-- Password -->
            <h5>Password</h5>
            <div class="bar2"></div>
            You can change your password every 24h<br>
            Your password should be between 6 and 32 chars. [6;32]<br>
            New password:<br>
            <input id="pwd_area" oninput="this.value = this.value.replace(/\n/g,'')" type="password" placeholder="Password..."></input> <div id="eye_button" onclick="showPwd()"><img src="img/eye.svg" style="width: 30px; margin-left: 10px;margin-top: 10px;"  alt="Eye"></div><br><br>
            <button name="submit" type="submit" class="submit" id="pwdbt">Submit</button>
            <div class="error_box" id="error_pwd"></div>


            <!-- Discord -->
            <h5>Discord</h5>
            <div class="bar2"></div>
            You can change your discord every 24h<br>
            Your current discord:<br>
            <a href="" id="discord_a">
                <div id="discord_button" onclick="changeDiscord()">
                    <div class="vertical-align">
                        <img src="img/discord.svg" style="width: 30px; height: 30px; margin-bottom: -8px;"  alt="Discord logo">
                        <span id = "discord_name">
                            No discord account
                        </span>
                    </div>
                </div>
            </a><br>
            Do you want your discord to be public:<br>
            <label class="slidebox_container" id="country_slider">
                <input type="checkbox" id="checkbox_discord">
                <span class="slider"></span>
            </label>
            <br><br>


            <!-- Country -->
            <h5>Country</h5>
            <div class="bar2"></div>
            You can disable your country every 5 seconds<br>
            Your current country:<br>
            <img src="img/flags/xx.svg" height="70px" id="country_img"><br>
            Do you want your country to be public:<br>
            <label class="slidebox_container" id="country_slider">
                <input type="checkbox" id="checkbox_country">
                <span class="slider"></span>
            </label>
            <div class="error_box" id="error_country"></div>
            <br><br>
            


            <!-- Smaller header -->
            <h5>Smaller header left</h5>
            <div class="bar2"></div>
            This option is here if you find that your left header is too big with too much icons
            <label class="slidebox_container" id="country_slider">
                <input type="checkbox" id="checkbox_header">
                <span class="slider"></span>
            </label>
            <br><br>


            <!-- Colors -->
            <h5>Colors</h5>
            <div class="bar2"></div>
            Pick a color for the theme of WeekGolf!
            <div style="    display: flex; flex-wrap: wrap; gap: 10px;">
                <div class="theme_button" id="theme_green" onclick="switchColorTheme('green')"></div>
                <div class="theme_button" id="theme_yellow" onclick="switchColorTheme('yellow')"></div>
                <div class="theme_button" id="theme_orange" onclick="switchColorTheme('orange')"></div>
                <div class="theme_button" id="theme_red" onclick="switchColorTheme('red')"></div>
                <div class="theme_button" id="theme_purple" onclick="switchColorTheme('purple')"></div>
                <div class="theme_button" id="theme_blue" onclick="switchColorTheme('blue')"></div>
                <div class="theme_button" id="theme_cyan" onclick="switchColorTheme('cyan')"></div>
            </div>
            <br><br>


            <!-- Disconnect -->
            <h5>Log out</h5>
            <div class="bar2"></div>
            If you click on this button you will be logged out.<br>
            <button id="disconnect_button" onclick="disconnect()">
                <div class="vertical-align" style="width: 99999px">
                    <span id = "discord_name">
                        LOG OUT
                    </span>
                </div>
            </button>
        </main>


        <!-- Footer -->
        <div data-include="footer.html"></div>




        <!-- JS -->
        <!-- Get IP and Country -->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

        <!-- Get country code-->
        <script>
            var country_code = "xx";

            async function getIpClient() {
                try {
                    const response = await axios.get('https://api.ipify.org?format=json');
                    const ip = response["data"]["ip"];

                    // Get country
                    const xhttp = new XMLHttpRequest();

                    xhttp.open("POST", "https://week.golf/getCountry.php", true);
                    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                    xhttp.send(`ip=${ip}`);

                    xhttp.onload = function (){
                        const rep = JSON.parse(xhttp.response);
                        const country = rep["country"];

                        country_code = country;
                        console.log(country_code);
                    }
                } catch (error) {
                    console.error(error);
                }
            }

            getIpClient();
        </script>


        <!-- Action with submit -->
        <script defer>
            // Get privates info
            function getPrivate(){
                const xhttp = new XMLHttpRequest();
                const token = localStorage.token;

                xhttp.open("POST", "https://week.golf/getPrivateByToken.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`t=${token}`);
                xhttp.onload = function() {
                    const rep = JSON.parse(xhttp.responseText);

                    document.getElementById("email").value = rep["email"];
                    document.getElementById("username_area").value = rep["username"];
                    document.getElementById("username_area").value = rep["username"];
                    document.getElementById("currentbio").textContent = rep["bio"];
                    if (!(rep["country"]!==null && rep["country"]!=="XX")){
                        document.getElementById("checkbox_country").checked = false;
                    } else {
                        document.getElementById("checkbox_country").checked = true;
                        document.getElementById("country_img").src = `img/flags/${rep["country"].toLowerCase()}.svg`;
                    }
                    if (rep["discord"]!==null)
                        document.getElementById("discord_name").textContent = rep["discord"];
                    if (rep["discord_display"] != 0){
                        document.getElementById("checkbox_discord").checked = true;
                    } else {
                        document.getElementById("checkbox_discord").checked = false;
                    }
                    if (rep["banner"]!==null)
                        document.getElementById("currentbanner").src= rep["banner"];
                    if (rep["pp"]!==null)
                        document.getElementById("currentpp").src= rep["pp"];
                }
            }
            getPrivate();

            // Token for Forms
            const tkn = document.getElementsByClassName("tkn");
            for (let i = 0; i < tkn.length; i ++){
                tkn[i].value = localStorage.token;
            }


            // WHen Submit 
            function submited(n){
                const submit_buttons = document.getElementsByClassName("submit");

                submit_buttons[n].style.transition = ".5s";
                submit_buttons[n].style.backgroundColor = "#6C6";
                submit_buttons[n].style.cursor = "not-allowed";
                submit_buttons[n].textContent = "Submited";
                submit_buttons[n].style.paddingLeft = "49px";
                submit_buttons[n].style.paddingRight = "49px";
            }

            // Sending bio
            ///////////////////////////
            function bioSend(){
                const xhttp = new XMLHttpRequest();
                const bio = document.getElementById("newbio").value;
                const token = localStorage.token;
                submited(2);

                xhttp.open("POST", "https://week.golf/bio.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`bio=${encodeURIComponent(bio)}&t=${token}`);
                xhttp.onload = function() {
                    const rep = JSON.parse(xhttp.responseText)
                    
                    if (rep["error"] != ""){
                        document.getElementById("error_bio").style.display = "block";
                        document.getElementById("error_bio").innerHTML = "<b style='font-size: 30px'>ERROR.</b><br>" + rep["error"];
                    }
                }
            }

            // Sending Email
            ///////////////////////////////
            function emailSend(){
                const xhttp = new XMLHttpRequest();
                const email = document.getElementById("email").value;
                const token = localStorage.token;

                submited(3);

                xhttp.open("POST", "https://week.golf/email.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`email=${encodeURIComponent(email)}&t=${token}`);
                xhttp.onload = function() {
                    const rep = JSON.parse(xhttp.responseText)
                    
                    if (rep["error"] != ""){
                        document.getElementById("error_email").style.display = "block";
                        document.getElementById("error_email").innerHTML = "<b style='font-size: 30px'>ERROR.</b><br>" + rep["error"];
                    }
                }
            }
            
            // Username
            ////////////////////////
            function usernameSend(){
                const xhttp = new XMLHttpRequest();
                const username = document.getElementById("username_area").value;
                const token = localStorage.token;

                submited(4);

                xhttp.open("POST", "https://week.golf/username.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`username=${encodeURIComponent(username)}&t=${token}`);
                xhttp.onload = function() {
                    const rep = JSON.parse(xhttp.responseText);
                    
                    if (rep["error"] != ""){
                        document.getElementById("error_username").style.display = "block";
                        document.getElementById("error_username").innerHTML = "<b style='font-size: 30px'>ERROR.</b><br>" + rep["error"];
                    }
                }
            }
            
            // PWD
            //////////////////////////////
            function pwdSend(){
                const xhttp = new XMLHttpRequest();
                const pwd = document.getElementById("pwd_area").value;
                const token = localStorage.token;

                submited(5);

                xhttp.open("POST", "https://week.golf/pwd.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`pwd=${encodeURIComponent(pwd)}&t=${token}`);
                xhttp.onload = function() {
                    const rep = JSON.parse(xhttp.responseText)

                    if (rep["error"] != ""){
                        document.getElementById("error_pwd").style.display = "block";
                        document.getElementById("error_pwd").innerHTML = "<b style='font-size: 30px'>ERROR.</b><br>" + rep["error"];
                    }
                }
            }

            function showPwd(){
                document.getElementById("pwd_area").type = (document.getElementById("pwd_area").type === 'password')?"text":"password";
            }

            function disconnect(){
                localStorage.token = "";
                document.location.href = "https://week.golf";
            }

            // Slider country
            ////////////////////////////////////
            document.getElementById("checkbox_country").addEventListener("change", function(){
                const xhttp = new XMLHttpRequest();
                let newCountry = "";

                // Change the country depending on the check of the slider
                if (this.checked){
                    newCountry = country_code;
                } else {
                    newCountry = "XX";
                }

                // Change image
                document.getElementById("country_img").src = `img/flags/${newCountry.toLowerCase()}.svg`;

                xhttp.open("POST", "https://week.golf/countrySwitch.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`t=${localStorage.token}&c=${newCountry}`);
                xhttp.onload = function() {
                    const rep = JSON.parse(xhttp.responseText);
                    
                    if (rep["error"] != ""){
                        document.getElementById("error_country").style.display = "block";
                        document.getElementById("error_country").innerHTML = "<b style='font-size: 30px'>ERROR.</b><br>" + rep["error"];
                    }
                }
            });

            // Discord Display
            ////////////////////////////////////
            document.getElementById("checkbox_discord").addEventListener("change", function(){
                const xhttp = new XMLHttpRequest();
                xhttp.open("POST", "https://week.golf/displayDiscord.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`t=${localStorage.token}`);
            });

            // SMALL HEADER
            ///////////////////////////////////
            function smallHeader(){
                if (localStorage.smallHeader === null)
                    localStorage.smallHeader = "big";
                let boolean = localStorage.smallHeader === "small";

                if (boolean){
                    document.getElementById("checkbox_header").checked = false;
                    localStorage.smallHeader = "big";
                } else {
                    document.getElementById("checkbox_header").checked = true;
                    localStorage.smallHeader = "small";
                } 
            }
            smallHeader();
            smallHeader();
            document.getElementById("checkbox_header").addEventListener("change",smallHeader);


            document.getElementById("discord_a").href = "https://week.golf/discord_init.php?t=" + localStorage.token;

            document.getElementById("biosubmit").addEventListener("click", bioSend);
            document.getElementById("emailbt").addEventListener("click", emailSend);
            document.getElementById("usernamebt").addEventListener("click", usernameSend);
            document.getElementById("pwdbt").addEventListener("click", pwdSend);

        </script>


        <!-- When the image is loaded -->
        <script defer>
            document.getElementById("ppinput").onchange = function () {
                const [file] = document.getElementById("ppinput").files;
                if (file) {
                    document.getElementById("currentpp").src = URL.createObjectURL(file);
                }
            }

            document.getElementById("bannerinput").onchange = function () {
                const [file] = document.getElementById("bannerinput").files;
                if (file) {
                    document.getElementById("currentbanner").src = URL.createObjectURL(file);
                }
            }
        </script>


        <!-- Colors -->
        <script>
            function switchColorTheme(color) {
                document.documentElement.setAttribute('data-color-theme', color);
                localStorage.setItem('colorTheme', color);
            }
        </script>
    </body>
</html>